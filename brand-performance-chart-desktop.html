<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand Performance Across Months : Desktop</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
            overflow-x: hidden;
        }
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
        }
        .header h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 400;
        }
        .chart-section {
            padding: 20px;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 2700px; /* Increased height for better vertical spacing */
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .good { background-color: #27ae60; }
        .ni { background-color: #f39c12; }
        .poor { background-color: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Brand Performance Across Months : Desktop</h1>
            <p>Horizontal Stacked Bar Chart with Brand Separators</p>
        </div>
        
        <div class="chart-section">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color good"></div>
                    <span>Good Performance</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color ni"></div>
                    <span>Needs Improvement</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color poor"></div>
                    <span>Poor Performance</span>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Direct brand performance data in flat array format
        const brandData = [
  {brand: 'DVW', month: 'June', good: 722, ni: 0, poor: 13},
  {brand: 'MRE', month: 'June', good: 1671, ni: 22, poor: 0},
  {brand: 'RBW', month: 'June', good: 869, ni: 0, poor: 0},
  {brand: 'SHG', month: 'June', good: 585, ni: 0, poor: 0},
  {brand: 'WDG', month: 'June', good: 1197, ni: 0, poor: 0},
  {brand: 'HMS', month: 'June', good: 336, ni: 0, poor: 0},
  {brand: 'MOJ', month: 'June', good: 1414, ni: 68, poor: 0},
  {brand: 'GUY.ca', month: 'June', good: 414, ni: 0, poor: 0},
  {brand: 'GUY.com', month: 'June', good: 1609, ni: 0, poor: 0},
  {brand: 'MLY', month: 'June', good: 623, ni: 608, poor: 1115},
  {brand: 'MRR CA', month: 'June', good: 1111, ni: 0, poor: 0},
  {brand: 'MRR US', month: 'June', good: 2385, ni: 0, poor: 0},
  {brand: 'PDS', month: 'June', good: 1050, ni: 17, poor: 0},
  {brand: 'ASV US', month: 'June', good: 1483, ni: 7, poor: 0},
  {brand: 'ASV CA', month: 'June', good: 251, ni: 0, poor: 0},
  {brand: 'MDG', month: 'June', good: 2461, ni: 0, poor: 0},
  {brand: 'PLG', month: 'June', good: 207, ni: 0, poor: 0},
  {brand: 'MRA CA', month: 'June', good: 268, ni: 0, poor: 0},
  {brand: 'MRA US', month: 'June', good: 2036, ni: 728, poor: 0},
  {brand: 'FSP', month: 'June', good: 1342, ni: 0, poor: 0},
  {brand: 'MRH CA', month: 'June', good: 0, ni: 0, poor: 0},
  {brand: 'MRH US', month: 'June', good: 0, ni: 0, poor: 0},
  {brand: 'LAP', month: 'June', good: 0, ni: 0, poor: 0},
  
  {brand: 'DVW', month: 'July', good: 744, ni: 0, poor: 0},
  {brand: 'MRE', month: 'July', good: 1579, ni: 0, poor: 0},
  {brand: 'RBW', month: 'July', good: 841, ni: 0, poor: 0},
  {brand: 'SHG', month: 'July', good: 473, ni: 0, poor: 0},
  {brand: 'WDG', month: 'July', good: 0, ni: 1344, poor: 112},
  {brand: 'HMS', month: 'July', good: 349, ni: 0, poor: 0},
  {brand: 'MOJ', month: 'July', good: 1434, ni: 40, poor: 0},
  {brand: 'GUY.ca', month: 'July', good: 402, ni: 0, poor: 0},
  {brand: 'GUY.com', month: 'July', good: 1512, ni: 0, poor: 0},
  {brand: 'MLY', month: 'July', good: 2136, ni: 249, poor: 0},
  {brand: 'MRR CA', month: 'July', good: 1048, ni: 0, poor: 0},
  {brand: 'MRR US', month: 'July', good: 2331, ni: 0, poor: 0},
  {brand: 'PDS', month: 'July', good: 927, ni: 4, poor: 2},
  {brand: 'ASV US', month: 'July', good: 1553, ni: 0, poor: 0},
  {brand: 'ASV CA', month: 'July', good: 228, ni: 0, poor: 0},
  {brand: 'MDG', month: 'July', good: 2532, ni: 0, poor: 0},
  {brand: 'PLG', month: 'July', good: 198, ni: 0, poor: 0},
  {brand: 'MRA CA', month: 'July', good: 257, ni: 0, poor: 0},
  {brand: 'MRA US', month: 'July', good: 2738, ni: 0, poor: 171},
  {brand: 'FSP', month: 'July', good: 1343, ni: 0, poor: 0},
  {brand: 'MRH CA', month: 'July', good: 170, ni: 52, poor: 0},
  {brand: 'MRH US', month: 'July', good: 3792, ni: 168, poor: 159},
  {brand: 'LAP', month: 'July', good: 0, ni: 0, poor: 0},
  
  {brand: 'DVW', month: 'Aug', good: 854, ni: 0, poor: 0},
  {brand: 'MRE', month: 'Aug', good: 1232, ni: 1, poor: 11},
  {brand: 'RBW', month: 'Aug', good: 940, ni: 0, poor: 0},
  {brand: 'SHG', month: 'Aug', good: 491, ni: 0, poor: 0},
  {brand: 'WDG', month: 'Aug', good: 1446, ni: 61, poor: 0},
  {brand: 'HMS', month: 'Aug', good: 376, ni: 0, poor: 0},
  {brand: 'MOJ', month: 'Aug', good: 1713, ni: 21, poor: 73},
  {brand: 'GUY.ca', month: 'Aug', good: 414, ni: 0, poor: 0},
  {brand: 'GUY.com', month: 'Aug', good: 1389, ni: 0, poor: 0},
  {brand: 'MLY', month: 'Aug', good: 2338, ni: 273, poor: 0},
  {brand: 'MRR CA', month: 'Aug', good: 1256, ni: 0, poor: 0},
  {brand: 'MRR US', month: 'Aug', good: 3448, ni: 0, poor: 0},
  {brand: 'PDS', month: 'Aug', good: 956, ni: 0, poor: 1},
  {brand: 'ASV US', month: 'Aug', good: 1913, ni: 0, poor: 53},
  {brand: 'ASV CA', month: 'Aug', good: 255, ni: 0, poor: 0},
  {brand: 'MDG', month: 'Aug', good: 2539, ni: 0, poor: 0},
  {brand: 'PLG', month: 'Aug', good: 196, ni: 0, poor: 0},
  {brand: 'MRA CA', month: 'Aug', good: 283, ni: 0, poor: 0},
  {brand: 'MRA US', month: 'Aug', good: 3025, ni: 181, poor: 0},
  {brand: 'FSP', month: 'Aug', good: 1245, ni: 134, poor: 0},
  {brand: 'MRH CA', month: 'Aug', good: 198, ni: 44, poor: 0},
  {brand: 'MRH US', month: 'Aug', good: 4296, ni: 120, poor: 89},
  {brand: 'LAP', month: 'Aug', good: 0, ni: 0, poor: 0},
  
  {brand: 'DVW', month: 'Sept', good: 873, ni: 0, poor: 0},
  {brand: 'MRE', month: 'Sept', good: 1201, ni: 287, poor: 0},
  {brand: 'RBW', month: 'Sept', good: 1024, ni: 0, poor: 0},
  {brand: 'SHG', month: 'Sept', good: 575, ni: 0, poor: 0},
  {brand: 'WDG', month: 'Sept', good: 1361, ni: 64, poor: 0},
  {brand: 'HMS', month: 'Sept', good: 346, ni: 0, poor: 0},
  {brand: 'MOJ', month: 'Sept', good: 1664, ni: 83, poor: 20},
  {brand: 'GUY.ca', month: 'Sept', good: 412, ni: 0, poor: 0},
  {brand: 'GUY.com', month: 'Sept', good: 1601, ni: 33, poor: 0},
  {brand: 'MLY', month: 'Sept', good: 1330, ni: 994, poor: 6},
  {brand: 'MRR CA', month: 'Sept', good: 1411, ni: 9, poor: 0},
  {brand: 'MRR US', month: 'Sept', good: 281, ni: 253, poor: 0},
  {brand: 'PDS', month: 'Sept', good: 989, ni: 0, poor: 0},
  {brand: 'ASV US', month: 'Sept', good: 1757, ni: 7, poor: 57},
  {brand: 'ASV CA', month: 'Sept', good: 274, ni: 0, poor: 0},
  {brand: 'MDG', month: 'Sept', good: 2271, ni: 311, poor: 0},
  {brand: 'PLG', month: 'Sept', good: 193, ni: 12, poor: 0},
  {brand: 'MRA CA', month: 'Sept', good: 288, ni: 0, poor: 0},
  {brand: 'MRA US', month: 'Sept', good: 2693, ni: 518, poor: 0},
  {brand: 'FSP', month: 'Sept', good: 1408, ni: 140, poor: 0},
  {brand: 'MRH CA', month: 'Sept', good: 235, ni: 14, poor: 0},
  {brand: 'MRH US', month: 'Sept', good: 4500, ni: 98, poor: 28},
  {brand: 'LAP', month: 'Sept', good: 376, ni: 0, poor: 0}
];

        // Create labels and data arrays grouped by brand with months
        const labels = [];
        const goodData = [];
        const niData = [];
        const poorData = [];
        const separatorIndices = [];
        const warningFlags = []; // Track which bars need warning icons

        // Get unique brands and months
        const uniqueBrands = [...new Set(brandData.map(item => item.brand))];
        const uniqueMonths = [...new Set(brandData.map(item => item.month))];
        const lastMonth = uniqueMonths[uniqueMonths.length - 1]; // Get the last month dynamically
        
        let currentIndex = 0;
        uniqueBrands.forEach((brand, brandIndex) => {
            // Get all months for this brand
            const brandMonths = brandData.filter(item => item.brand === brand);
            
            brandMonths.forEach((item, monthIndex) => {
                // Show brand name and month for all entries
                labels.push(`${item.brand} - ${item.month}`);
                
                goodData.push(item.good);
                niData.push(item.ni);
                poorData.push(item.poor);
                
                // Check if Poor or NI increased compared to previous month
                // Only show warning flag on the last month if there's an increase
                let needsWarning = false;
                if (item.month === lastMonth && monthIndex > 0) {
                    const prevMonth = brandMonths[monthIndex - 1];
                    if (item.poor > prevMonth.poor || item.ni > prevMonth.ni) {
                        needsWarning = true;
                    }
                }
                warningFlags.push(needsWarning);
                
                currentIndex++;
            });
            
            // Add spacing and separator after each brand (except the last one)
            if (brandIndex < uniqueBrands.length - 1) {
                // Add empty spacing entries for visual separation
                labels.push(''); // Empty label for spacing
                goodData.push(0);
                niData.push(0);
                poorData.push(0);
                warningFlags.push(false); // No warning for spacing entries
                currentIndex++;
                
                // Add separator line
                separatorIndices.push(currentIndex - 0.5);
                
                // Add another empty spacing entry
                labels.push(''); // Empty label for spacing
                goodData.push(0);
                niData.push(0);
                poorData.push(0);
                warningFlags.push(false); // No warning for spacing entries
                currentIndex++;
            }
        });

        const ctx = document.getElementById('performanceChart').getContext('2d');
        
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Good',
                        data: goodData,
                        backgroundColor: '#27ae60',
                        borderWidth: 0
                    },
                    {
                        label: 'NI',
                        data: niData,
                        backgroundColor: '#f39c12',
                        borderWidth: 0
                    },
                    {
                        label: 'Poor',
                        data: poorData,
                        backgroundColor: '#e74c3c',
                        borderWidth: 0
                    }
                ]
            },
            options: {
                indexAxis: 'y', // This makes it horizontal
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false // We have custom legend
                    },
                    tooltip: {
                        enabled: true,
                        mode: 'nearest',
                        intersect: true,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 6,
                        padding: 10,
                        displayColors: true,
                        filter: function(tooltipItem) {
                            // Don't show tooltip for empty spacing entries
                            return tooltipItem.label !== '' && tooltipItem.raw > 0;
                        },
                        callbacks: {
                            title: function(tooltipItems) {
                                if (tooltipItems && tooltipItems.length > 0) {
                                    return tooltipItems[0].label;
                                }
                                return '';
                            },
                            label: function(context) {
                                const value = context.raw;
                                if (value === 0) return null; // Don't show zero values
                                
                                let label = '';
                                if (context.dataset.label === 'Good') {
                                    label = 'Good Performance';
                                } else if (context.dataset.label === 'NI') {
                                    label = 'Needs Improvement';
                                } else {
                                    label = 'Poor Performance';
                                }
                                return `${label}: ${value.toLocaleString()}`;
                            },
                            footer: function(tooltipItems) {
                                if (tooltipItems && tooltipItems.length > 0) {
                                    const dataIndex = tooltipItems[0].dataIndex;
                                    let total = 0;
                                    tooltipItems.forEach(function(tooltipItem) {
                                        if (tooltipItem.raw > 0) {
                                            total += tooltipItem.raw;
                                        }
                                    });
                                    
                                    let footerText = '';
                                    if (total > 0) {
                                        footerText = `Total Pages: ${total.toLocaleString()}`;
                                    }
                                    
                                    // Add warning message if this bar has a warning flag
                                    if (warningFlags[dataIndex]) {
                                        footerText += footerText ? '\n‚ö†Ô∏è Attention: Poor/NI increased from previous month' : 
                                                     '‚ö†Ô∏è Attention: Poor/NI increased from previous month';
                                    }
                                    
                                    return footerText;
                                }
                                return '';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        },
                        ticks: {
                            callback: function(value) {
                                if (value >= 1000) {
                                    return (value / 1000) + 'k';
                                }
                                return value;
                            }
                        }
                    },
                    y: {
                        stacked: true,
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: '#2c3e50',
                            font: {
                                size: 11,
                                weight: 'bold'
                            },
                            callback: function(value, index) {
                                // Hide empty spacing labels
                                const label = this.getLabelForValue(value);
                                return label === '' ? '' : label;
                            }
                        }
                    }
                },
                interaction: {
                    mode: 'nearest',
                    intersect: true
                },
                animation: {
                    duration: 300,
                    easing: 'easeInOutCubic'
                },
                hover: {
                    mode: 'nearest',
                    intersect: true,
                    animationDuration: 200
                }
            },
            plugins: [{
                afterDraw: function(chart) {
                    const ctx = chart.ctx;
                    const yAxis = chart.scales.y;
                    const xAxis = chart.scales.x;
                    
                    // Draw separator lines between brands
                    separatorIndices.forEach(index => {
                        const y = yAxis.getPixelForValue(index);
                        
                        ctx.save();
                        ctx.strokeStyle = '#2c3e50';
                        ctx.lineWidth = 2;
                        ctx.setLineDash([5, 5]);
                        ctx.beginPath();
                        ctx.moveTo(chart.chartArea.left, y);
                        ctx.lineTo(chart.chartArea.right, y);
                        ctx.stroke();
                        ctx.restore();
                    });
                    
                    // Draw warning icons for bars that need attention
                    chart.data.labels.forEach((label, index) => {
                        if (warningFlags[index] && label !== '') {
                            // Calculate the end position of the stacked bar
                            const good = goodData[index] || 0;
                            const ni = niData[index] || 0;
                            const poor = poorData[index] || 0;
                            const total = good + ni + poor;
                            
                            if (total > 0) {
                                const x = xAxis.getPixelForValue(total) + 10; // Position after the bar
                                const y = yAxis.getPixelForValue(index);
                                
                                ctx.save();
                                ctx.font = '16px Arial';
                                ctx.fillStyle = '#e74c3c';
                                ctx.textAlign = 'left';
                                ctx.textBaseline = 'middle';
                                
                                // Draw warning triangle icon
                                ctx.fillText('‚ö†Ô∏è', x, y);
                                
                                ctx.restore();
                            }
                        }
                    });
                }
            }]
        });
    </script>
</body>
</html>